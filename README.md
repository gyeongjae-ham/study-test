# JUnit5 Test

1. 단위 테스트
2. TDD: Test Driven Development
3. DisplayName, BDD 스타일
4. Spring & JPA 기반 테스트
5. Mock
6. 더 나은 테스트
7. Spring REST Docs

## 테스트 케이스 세분화하기

### 요구사항이 왔을 경우

- 요구사항에 해피케이스만 있는지 예외 케이스 여부를 확인해봐야 한다
- 범위, 구간, 날짜 등이 포함된 요구사항이라면 테스트시에 경계값을 테스트하는 것이 좋다
- 범위, 구간, 날짜 등이 포함됐을 경우에는 예외 케이스는 경계값 벗어나는 값을 테스트하면 된다

### 테스트하기 어려운 영역을 구분하고 분리하기

- 요구사항에 변하는 값이 있는 경우 테스트가 실행할 때마다 결과가 다를 수 있다(시간 등)
- 테스트하기 어려운 영역을 외부로 분리해서 고정된 값으로 테스트할 수 있도록 한다

### 테스트 하기 어려운 영역

> <strong>관측할 때마다 다른 값에 의존하는 코드</strong>
>   - 현재 날짜/시간, 랜덤 값, 전역 변수/함수, 사용자 입력 등</br>

> <strong>외부 세계에 영향을 주는 코드</strong>
>   - 표준 출력, 메시지 발송, 데이터베이스에 기록하기 등</br>

### 테스트 하기 쉬운 영역

> 순수함수

- 같은 입력에는 항상 같은 결과
- 외부 세상과 단절된 형태
- 테스트하기 쉬운 코드

## TDD(Test Driven Development)

- TDD의 순기능: 피드백
- 만약 선 기능 구현, 후 테스트 작성이라면
    - 테스트 자체의 누락 가능성
    - 특정 테스트 케이스(해피 케이스)만 검증할 가능성
    - 잘못된 구현을 다소 늦게 발견할 가능성
- TDD 방법으로 개발하면
    - 복잡도가 낮은, 테스트 가능한 코드(유연하며 유지보수가 쉬운)로 구현할 수 있게 한다
    - 쉽게 발견하기 어려운 엣지(Edge) 케이스를 놓치지 않게 해준다
    - 구현에 대한 빠른 피드백을 받을 수 있다.
    - 과감한 리팩토링이 가능해진다.

## 테스트 코드는 문서다

- 프로덕션 기능을 설명하는 테스트 코드 문서
- 다양한 테스트 케이스를 통해 프로덕션 코드를 이해하는 시각과 관점을 보완
- 어느 한 사람이 과거에 경험했던 고민의 결과물을 팀 차원으로 승격시켜서, 모두의 자산을 공유할 수 있다

## BDD(Behavior Driven Development)

- TDD에서 파생된 개발 방법
- 함수 단위의 테스트에 집중하기보다, 시나리오에 기반한 테스트케이스(TC) 자체에 집중하여 테스트한다.
- 개발자가 아닌 사람이 봐도 이해할 수 있을 정도의 추상화 수준(레벨)을 권장

### Given / When / Then

- Given: 시나리오 진행에 필요한 모든 준비 과정(객체, 값, 상태 등)
- When: 시나리오 행동 진행
- Then: 시나리오 진행에 대한 결과 명시, 검증

## 통합 테스트

- 여러 모듈이 협력하는 기능을 통합적으로 검증하는 테스트
- 일반적으로 작은 범위의 단위 테스트만으로는 기능 전체의 신뢰성을 보장할 수 없다.
- 풍부한 단위 테스트 & 큰 기능 단위를 검증하는 통합 테스트

# 더 나은 테스트 작성법

## 한 문단에 한 주제

- 한 가지 테스트에서는 한 가지 목적의 검증만 수행을 한다
- 여러 상황에 대한 테스트는 Parameterize를 이용하자

## 완벽하게 제어하기

- 어떤 테스트 환경을 만들 때, 완벽하게 제어가 가능한 환경을 만들 수 있는지 확인해야한다.

# 테스트 환경의 독립성을 보장하자

# 테스트 간 독립성을 보장하자

- 두 개 이상의 테스트가 static한 변수 등 공유 자원을 사용해서 테스트 간 연관성이 생기는 걸 방지하자.
- 테스트 간에는 순서 상관없이 항상 같은 결과를 내야 한다.

# 한 눈에 들어오는 Test Fixture 구성하기

> Test Fixture</br>
> Fixture: 고정물, 고정되어 있는 물체</br>
> 테스트를 위해 원하는 상태로 고정시킨 일련의 객체(given 절)</br>

- 각 테스트 입장에서 봤을 때 아예 몰라도 테스트 내용을 이해하는 데에 문제가 없는지 확인
- 수정해도 모든 테스트에 영향을 주지 않는지 확인
- 빌더를 메소드화 할 때, 테스트에 필요한 값만 파라미터화 하는 게 좋다

# Test Fixture 클렌징

- deleteAll은 deleteAllInBatch와 달리 관계 되는 객체를 가져와서 건건히 지우므로 성능상의 차이가 있음

# ParameterizedTest

- 값을 바꿔보면서 테스트를 여러번하고 싶을 경우 사용한다.
